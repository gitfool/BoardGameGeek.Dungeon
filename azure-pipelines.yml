trigger:
- master

variables:
- group: Cake

jobs:
- job: Docker
  pool:
    vmImage: ubuntu-16.04
  container:
    image: dockfool/cake-docker:latest
  steps:
  - task: Docker@1
    displayName: Docker login
    inputs:
      command: login
      containerRegistryType: Container Registry
      dockerRegistryEndpoint: DockerHub

  - bash: |
      set -ex
      sudo groupadd -g $(stat --format='%g' /var/run/docker.sock) docker
      sudo usermod -a -G docker $(whoami)
    displayName: Docker socket

  - bash: cake --bootstrap && cake --verbosity=$(Cake.Verbosity) --ispublisher=true
    displayName: Cake build
